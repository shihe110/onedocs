<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Maven入门总结 | 毫末之木</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/onedocs/logo.png">
    <meta name="description" content="合抱之木生于毫末，九层之台起于累土，千里之行始于足下">
    <link rel="preload" href="/onedocs/assets/css/0.styles.de272f6a.css" as="style"><link rel="preload" href="/onedocs/assets/js/app.506d831c.js" as="script"><link rel="preload" href="/onedocs/assets/js/2.2038ef08.js" as="script"><link rel="preload" href="/onedocs/assets/js/41.aa15c834.js" as="script"><link rel="prefetch" href="/onedocs/assets/js/10.1d9c327b.js"><link rel="prefetch" href="/onedocs/assets/js/11.dd41172a.js"><link rel="prefetch" href="/onedocs/assets/js/12.1c15cdd6.js"><link rel="prefetch" href="/onedocs/assets/js/13.513a5d95.js"><link rel="prefetch" href="/onedocs/assets/js/14.e480d7b2.js"><link rel="prefetch" href="/onedocs/assets/js/15.ce172613.js"><link rel="prefetch" href="/onedocs/assets/js/16.c3c73e3f.js"><link rel="prefetch" href="/onedocs/assets/js/17.f9e960f8.js"><link rel="prefetch" href="/onedocs/assets/js/18.508cc703.js"><link rel="prefetch" href="/onedocs/assets/js/19.3c436336.js"><link rel="prefetch" href="/onedocs/assets/js/20.d542b18a.js"><link rel="prefetch" href="/onedocs/assets/js/21.e5d9810e.js"><link rel="prefetch" href="/onedocs/assets/js/22.077e0fec.js"><link rel="prefetch" href="/onedocs/assets/js/23.0b83b2d4.js"><link rel="prefetch" href="/onedocs/assets/js/24.0bac177c.js"><link rel="prefetch" href="/onedocs/assets/js/25.827ee48c.js"><link rel="prefetch" href="/onedocs/assets/js/26.989d850b.js"><link rel="prefetch" href="/onedocs/assets/js/27.e988df89.js"><link rel="prefetch" href="/onedocs/assets/js/28.7d013db9.js"><link rel="prefetch" href="/onedocs/assets/js/29.f3e3d846.js"><link rel="prefetch" href="/onedocs/assets/js/3.45ec72d9.js"><link rel="prefetch" href="/onedocs/assets/js/30.52c1b11a.js"><link rel="prefetch" href="/onedocs/assets/js/31.69791889.js"><link rel="prefetch" href="/onedocs/assets/js/32.7db34448.js"><link rel="prefetch" href="/onedocs/assets/js/33.0aa96373.js"><link rel="prefetch" href="/onedocs/assets/js/34.149351ee.js"><link rel="prefetch" href="/onedocs/assets/js/35.ade710a1.js"><link rel="prefetch" href="/onedocs/assets/js/36.ddf30b9a.js"><link rel="prefetch" href="/onedocs/assets/js/37.19b299c6.js"><link rel="prefetch" href="/onedocs/assets/js/38.587ea51e.js"><link rel="prefetch" href="/onedocs/assets/js/39.be232c36.js"><link rel="prefetch" href="/onedocs/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/onedocs/assets/js/40.09121296.js"><link rel="prefetch" href="/onedocs/assets/js/42.18e645d1.js"><link rel="prefetch" href="/onedocs/assets/js/43.0a9375e0.js"><link rel="prefetch" href="/onedocs/assets/js/44.43ba35ad.js"><link rel="prefetch" href="/onedocs/assets/js/45.a72e6747.js"><link rel="prefetch" href="/onedocs/assets/js/46.f1bd70cc.js"><link rel="prefetch" href="/onedocs/assets/js/47.97e9f9b4.js"><link rel="prefetch" href="/onedocs/assets/js/48.94e08893.js"><link rel="prefetch" href="/onedocs/assets/js/49.43ecaf23.js"><link rel="prefetch" href="/onedocs/assets/js/5.68fa5b24.js"><link rel="prefetch" href="/onedocs/assets/js/50.a31f8fe0.js"><link rel="prefetch" href="/onedocs/assets/js/51.33314693.js"><link rel="prefetch" href="/onedocs/assets/js/52.488f525d.js"><link rel="prefetch" href="/onedocs/assets/js/53.f853afaa.js"><link rel="prefetch" href="/onedocs/assets/js/54.e071feb9.js"><link rel="prefetch" href="/onedocs/assets/js/6.1b28b054.js"><link rel="prefetch" href="/onedocs/assets/js/7.80046a6e.js"><link rel="prefetch" href="/onedocs/assets/js/8.5dece485.js"><link rel="prefetch" href="/onedocs/assets/js/9.ef403998.js">
    <link rel="stylesheet" href="/onedocs/assets/css/0.styles.de272f6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/onedocs/" class="home-link router-link-active"><img src="/onedocs/logo.png" alt="毫末之木" class="logo"> <span class="site-name can-hide">毫末之木</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/onedocs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/JavaApi/" class="nav-link">
  javaApi
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring系列" class="dropdown-title"><span class="title">Spring系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/Spring/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringMVC/" class="nav-link">
  spring-mvc
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringBoot/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringCloud/" class="nav-link">
  spring-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/sql/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具集" class="dropdown-title"><span class="title">工具集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/web/" class="nav-link">
  web
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/maven/" class="nav-link router-link-active">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/github/" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/browser/" class="nav-link">
  browser
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/idea/" class="nav-link">
  idea
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/shihe110" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/onedocs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/JavaApi/" class="nav-link">
  javaApi
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring系列" class="dropdown-title"><span class="title">Spring系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/Spring/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringMVC/" class="nav-link">
  spring-mvc
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringBoot/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/SpringCloud/" class="nav-link">
  spring-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/sql/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具集" class="dropdown-title"><span class="title">工具集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/onedocs/web/" class="nav-link">
  web
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/maven/" class="nav-link router-link-active">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/github/" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/browser/" class="nav-link">
  browser
</a></li><li class="dropdown-item"><!----> <a href="/onedocs/idea/" class="nav-link">
  idea
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/shihe110" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>maven</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/onedocs/maven/Maven入门总结.html" class="active sidebar-link">Maven入门总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#maven入门总结" class="sidebar-link">Maven入门总结</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#_1-maven介绍" class="sidebar-link">1.maven介绍</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#_2-maven安装" class="sidebar-link">2.maven安装</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#_3-配置" class="sidebar-link">3.配置</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#maven常用命令" class="sidebar-link">maven常用命令</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#maven依赖管理" class="sidebar-link">maven依赖管理</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#构建流程" class="sidebar-link">构建流程</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#插件使用" class="sidebar-link">插件使用</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#多模块管理聚合工程" class="sidebar-link">多模块管理聚合工程</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#maven-wrapper" class="sidebar-link">Maven Wrapper</a></li><li class="sidebar-sub-header"><a href="/onedocs/maven/Maven入门总结.html#发布artifact到maven的repo中" class="sidebar-link">发布Artifact到Maven的repo中</a></li></ul></li><li><a href="/onedocs/maven/" aria-current="page" class="sidebar-link">首页</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="maven入门总结"><a href="#maven入门总结" class="header-anchor">#</a> Maven入门总结</h2> <h2 id="_1-maven介绍"><a href="#_1-maven介绍" class="header-anchor">#</a> 1.maven介绍</h2> <p>1.1 maven旨在解决什么问题？
java生态中各种jar包之间存在关联，在使用前要确认jar包的其他依赖包，所以依赖管理会很麻烦，这是maven要解决的一个问题。</p> <p>多模块项目，每个模块无法独立运行，maven工具可以实现项目一键打包。</p> <p>1.2 maven是什么
Maven 是一个项目管理工具，它包含了一个项目对象模型（Project Object Model），反映在配置中，就是一个 pom.xml 文件。是一组标准集合，一个项目的生命周期、一个依赖管理系统，另外还包括定义在项目生命周期阶段的插件(plugin)以及目标(goal)。</p> <p>当我们使用 Maven 的使用，通过一个自定义的项目对象模型，pom.xml 来详细描述我们自己的项目。</p> <p>Maven 中的有两大核心：</p> <ul><li>依赖管理：对 jar 的统一管理(Maven 提供了一个 Maven 的中央仓库，https://mvnrepository.com/，当我们在项目中添加完依赖之后，Maven 会自动去中央仓库下载相关的依赖，并且解决依赖的依赖问题)</li> <li>项目构建：对项目进行编译、测试、打包、部署、上传到私服等</li></ul> <h2 id="_2-maven安装"><a href="#_2-maven安装" class="header-anchor">#</a> 2.maven安装</h2> <p>前提：安装jdk</p> <p>1.下载maven  地址：http://maven.apache.org/download.cgi</p> <p>2.解压配置</p> <p>配置环境变量：</p> <p>新建系统变量MAVEN_HOME  D:\apache-maven-3.3.9</p> <p>编辑环境变量</p> <p>%MAVEN_HOME%\bin</p> <p>3.配置完毕检查安装情况</p> <p>cmd：mvn -v</p> <p>-- 安装成功则会打印出版本信息</p> <h2 id="_3-配置"><a href="#_3-配置" class="header-anchor">#</a> 3.配置</h2> <p>maven默认使用其中央仓库，下载速度较慢，可以配置国内镜像如：阿里云中央仓库</p> <p>3.1 仓库类型</p> <div class="language-xml extra-class"><pre class="language-xml"><code>仓库类型	说明
本地仓库	就是你自己电脑上的仓库，每个人电脑上都有一个仓库，默认位置在 当前用户名\.m2\repository
私服仓库	一般来说是公司内部搭建的 Maven 私服，处于局域网中，访问速度较快，这个仓库中存放的 jar 一般就是公司内部自己开发的 jar
中央仓库	有 Apache 团队来维护，包含了大部分的 jar，早期不包含 Oracle 数据库驱动，从 2019 年 8 月开始，包含了 Oracle 驱动
</code></pre></div><p>jar 包查找顺序：</p> <p>首先查找【本地仓库】-找不到-则优先去【私服仓库】-再去中央仓库（如果没有安装私服则直接取中央仓库）</p> <p>3.2 配置本地仓库</p> <p>本地仓库默认位置：用户.m2\repository, 一般使用默认地址，也可自定义配置</p> <p>在settings下配置：如  <localRepository>d:\maven\repositry</localRepository></p> <p>3.3 配置阿里镜像仓库</p> <p>在settings中的<mirrors>下添加</mirrors></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus-aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Nexus aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="maven常用命令"><a href="#maven常用命令" class="header-anchor">#</a> maven常用命令</h2> <p>maven中常见命令，idea工具可以直接只用菜单，eclipse则需要手动输入命令。</p> <div class="language-xml extra-class"><pre class="language-xml"><code>mvn clean  清理  可以用来清理已经编译好的文件
mvn compile 编译 将java代码编译成class文件
mvn test  测试 项目测试
mvn package 打包 根据配置，将项目打成jar包或war包
mvn install 安装 手动向本地仓库安装一个jar 
mvn deploy 上传 将jar包上传到私服
</code></pre></div><p>这里需要注意的是，这些命令都不是独立运行的，它有一个顺序。举个简单例子：</p> <p>我想将 jar 上传到私服，那么就要构建 jar，就需要执行 package 命令，要打包，当然也需要测试，那就要走 mvn test 命令，要测试就要先编译…..，因此，最终所有的命令都会执行一遍。不过，开发者也可以手动配置不执行某一个命令，这就是跳过。一般来是，除了测试，其他步骤都不建议跳过。</p> <p>4.1 使用命令构建项目</p> <p>mvn archetype:generate -DgroupId=com.shihe -DartifactId=myapp -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</p> <p>4.2 对项目进行打包</p> <p>打包时命令行要定位到pom文件所在目录</p> <p>4.3 将项目安装到本地仓库</p> <p>mvn install</p> <h2 id="maven依赖管理"><a href="#maven依赖管理" class="header-anchor">#</a> maven依赖管理</h2> <p>Maven解决了依赖管理问题。</p> <p>例如，我们的项目依赖abc这个jar包，而abc又依赖xyz这个jar包：</p> <p>当我们声明了abc的依赖时，Maven自动把abc和xyz都加入了我们的项目依赖，不需要我们自己去研究abc是否需要依赖xyz。</p> <h3 id="依赖关系"><a href="#依赖关系" class="header-anchor">#</a> 依赖关系</h3> <p>Maven定义了几种依赖关系，分别是compile、test、runtime和provided：</p> <table><thead><tr><th>范围</th> <th style="text-align:center;">说明</th> <th style="text-align:right;">示例</th></tr></thead> <tbody><tr><td>compile</td> <td style="text-align:center;">编译时要用到（默认）</td> <td style="text-align:right;">commons-logging</td></tr> <tr><td>test</td> <td style="text-align:center;">测试时</td> <td style="text-align:right;">Junit</td></tr> <tr><td>runtime</td> <td style="text-align:center;">编译时不需要，但运行时需要</td> <td style="text-align:right;">mysql</td></tr> <tr><td>provided</td> <td style="text-align:center;">编译时要用，但运行时由jdk或某个服务器提供</td> <td style="text-align:right;">servlet-api</td></tr></tbody></table> <p>最后一个问题是，Maven如何知道从何处下载所需的相关的jar包？</p> <p>答案是Maven维护了一个中央仓库（repo1.maven.org），所有第三方库将自身的jar以及相关信息上传至中央仓库，Maven就可以从中央仓库把所需依赖下载到本地。</p> <p>Maven并不会每次都从中央仓库下载jar包。一个jar包一旦被下载过，就会被Maven自动缓存在本地目录（用户主目录的.m2目录），所以，除了第一次编译时因为下载需要时间会比较慢，后续过程因为有本地缓存，并不会重复下载相同的jar包。</p> <h3 id="唯一id"><a href="#唯一id" class="header-anchor">#</a> 唯一ID</h3> <p>对于某个依赖，Maven只需要3个变量即可唯一确定某个jar包：</p> <ul><li>groupId：属于组织的名称，类似Java的包名；</li> <li>artifactId：该jar包自身的名称，类似Java的类名；</li> <li>version：该jar包的版本。</li></ul> <p>通过上述3个变量，即可唯一确定某个jar包。</p> <p>Maven通过对jar包进行PGP签名确保任何一个jar包一经发布就无法修改。修改已发布jar包的唯一方法是发布一个新版本。</p> <p>因此，某个jar包一旦被Maven下载过，即可永久地安全缓存在本地。</p> <p>注：只有以-SNAPSHOT结尾的版本号会被Maven视为开发版本，开发版本每次都会重复下载，这种SNAPSHOT版本只能用于内部私有的Maven repo，公开发布的版本不允许出现SNAPSHOT。</p> <p>对于第三方组件jar，我们可以去maven中央仓库搜索关键字，获取器唯一id，并引入该依赖。</p> <h3 id="命令行编译"><a href="#命令行编译" class="header-anchor">#</a> 命令行编译</h3> <p>在pom.xml文件目录下，使用命令</p> <div class="language- extra-class"><pre class="language-text"><code>mvn clean  package
</code></pre></div><h2 id="构建流程"><a href="#构建流程" class="header-anchor">#</a> 构建流程</h2> <p>mavan定义了一个标准化的项目结构，同时也定义了一套标准化的构建流程，可以自动化实现编译，打包，发布，等等。</p> <h3 id="lifecycle、phase、goal"><a href="#lifecycle、phase、goal" class="header-anchor">#</a> lifecycle、phase、goal</h3> <ul><li><p>lifecycle相当于Java的package，它包含一个或多个phase；</p></li> <li><p>phase相当于Java的class，它包含一个或多个goal；</p></li> <li><p>goal相当于class的method，它其实才是真正干活的。</p></li></ul> <p>大多数情况，我们只要指定phase，就默认执行这些phase默认绑定的goal，只有少数情况，我们可以直接指定运行一个goal，例如，启动Tomcat服务器：</p> <div class="language- extra-class"><pre class="language-text"><code>mvn tomcat:run
</code></pre></div><p>Maven通过lifecycle、phase和goal来提供标准的构建流程。</p> <p>最常用的构建命令是指定phase，然后让Maven执行到指定的phase：</p> <ul><li>mvn clean</li> <li>mvn clean compile</li> <li>mvn clean test</li> <li>mvn clean package</li></ul> <p>通常情况，我们总是执行phase默认绑定的goal，因此不必指定goal。</p> <h2 id="插件使用"><a href="#插件使用" class="header-anchor">#</a> 插件使用</h2> <div class="language- extra-class"><pre class="language-text"><code>mvn compile
</code></pre></div><p>Maven将执行compile这个phase，这个phase会调用compiler插件执行关联的compiler:compile这个goal。</p> <p>实际上，执行每个phase，都是通过某个插件（plugin）来执行的，Maven本身其实并不知道如何执行compile，它只是负责找到对应的compiler插件，然后执行默认的compiler:compile这个goal来完成编译。</p> <p>所以，使用Maven，实际上就是配置好需要使用的插件，然后通过phase调用它们。</p> <table><thead><tr><th>插件名称</th> <th style="text-align:center;">对应执行phase</th></tr></thead> <tbody><tr><td>clean</td> <td style="text-align:center;">clean</td></tr> <tr><td>compiler</td> <td style="text-align:center;">compile</td></tr> <tr><td>surefire</td> <td style="text-align:center;">test</td></tr> <tr><td>jar</td> <td style="text-align:center;">package</td></tr></tbody></table> <p>如果标准插件无法满足需求，我们还可以使用自定义插件。使用自定义插件的时候，需要声明。例如，使用maven-shade-plugin可以创建一个可执行的jar，要使用这个插件，需要在pom.xml中声明它：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project&gt;
    ...
	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.2.1&lt;/version&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;phase&gt;package&lt;/phase&gt;
						&lt;goals&gt;
							&lt;goal&gt;shade&lt;/goal&gt;
						&lt;/goals&gt;
						&lt;configuration&gt;
                            ...
						&lt;/configuration&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
</code></pre></div><p>自定义插件往往需要一些配置，例如，maven-shade-plugin需要指定Java程序的入口，它的配置是：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;configuration&gt;
    &lt;transformers&gt;
        &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;
            &lt;mainClass&gt;com.itranswarp.learnjava.Main&lt;/mainClass&gt;
        &lt;/transformer&gt;
    &lt;/transformers&gt;
&lt;/configuration&gt;
</code></pre></div><p>Maven自带的标准插件例如compiler是无需声明的，只有引入其它的插件才需要声明。</p> <p>下面列举了一些常用的插件：</p> <ul><li>maven-shade-plugin：打包所有依赖包并生成可执行jar；</li> <li>cobertura-maven-plugin：生成单元测试覆盖率报告；</li> <li>findbugs-maven-plugin：对Java源码进行静态分析以找出潜在问题。</li></ul> <h2 id="多模块管理聚合工程"><a href="#多模块管理聚合工程" class="header-anchor">#</a> 多模块管理聚合工程</h2> <p>Maven可以有效地管理多个模块，我们只需要把每个模块当作一个独立的Maven项目，它们有各自独立的pom.xml。例如，模块A的pom.xml：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
    &lt;artifactId&gt;module-a&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;module-a&lt;/name&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;1.7.28&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
            &lt;version&gt;1.2.3&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
            &lt;version&gt;5.5.2&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre></div><p>模块B的pom.xml</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
    &lt;artifactId&gt;module-b&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;module-b&lt;/name&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;1.7.28&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
            &lt;version&gt;1.2.3&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
            &lt;version&gt;5.5.2&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre></div><p>可以看出来，模块A和模块B的pom.xml高度相似，因此，我们可以提取出共同部分作为parent：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
    &lt;artifactId&gt;parent&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;

    &lt;name&gt;parent&lt;/name&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;1.7.28&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
            &lt;version&gt;1.2.3&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
            &lt;version&gt;5.5.2&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre></div><p>注意到parent的<packaging>是pom而不是jar，因为parent本身不含任何Java代码。编写parent的pom.xml只是为了在各个模块中减少重复的配置。现在我们的整个工程结构如下：</packaging></p> <div class="language- extra-class"><pre class="language-text"><code>multiple-project
├── pom.xml
├── parent
│   └── pom.xml
├── module-a
│   ├── pom.xml
│   └── src
├── module-b
│   ├── pom.xml
│   └── src
└── module-c
    ├── pom.xml
    └── src
</code></pre></div><p>这样模块A就可以简化为：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;parent&gt;
        &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
        &lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;module-a&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;name&gt;module-a&lt;/name&gt;
&lt;/project&gt;
</code></pre></div><p>模块B、模块C都可以直接从parent继承，大幅简化了pom.xml的编写。</p> <p>如果模块A依赖模块B，则模块A需要模块B的jar包才能正常编译，我们需要在模块A中引入模块B：</p> <div class="language- extra-class"><pre class="language-text"><code>  ...
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
            &lt;artifactId&gt;module-b&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

</code></pre></div><p>最后，在编译的时候，需要在根目录创建一个pom.xml统一编译：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;
    &lt;artifactId&gt;build&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;name&gt;build&lt;/name&gt;

    &lt;modules&gt;
        &lt;module&gt;parent&lt;/module&gt;
        &lt;module&gt;module-a&lt;/module&gt;
        &lt;module&gt;module-b&lt;/module&gt;
        &lt;module&gt;module-c&lt;/module&gt;
    &lt;/modules&gt;
&lt;/project&gt;
</code></pre></div><p>这样，在根目录执行mvn clean package时，Maven根据根目录的pom.xml找到包括parent在内的共4个<module>，一次性全部编译。</module></p> <h3 id="中央仓库"><a href="#中央仓库" class="header-anchor">#</a> 中央仓库</h3> <p>其实我们使用的大多数第三方模块都是这个用法，例如，我们使用commons logging、log4j这些第三方模块，就是第三方模块的开发者自己把编译好的jar包发布到Maven的中央仓库中。</p> <h3 id="私有仓库"><a href="#私有仓库" class="header-anchor">#</a> 私有仓库</h3> <p>私有仓库是指公司内部如果不希望把源码和jar包放到公网上，那么可以搭建私有仓库。私有仓库总是在公司内部使用，它只需要在本地的~/.m2/settings.xml中配置好，使用方式和中央仓位没有任何区别。</p> <h3 id="本地仓库"><a href="#本地仓库" class="header-anchor">#</a> 本地仓库</h3> <p>本地仓库是指把本地开发的项目“发布”在本地，这样其他项目可以通过本地仓库引用它。但是我们不推荐把自己的模块安装到Maven的本地仓库，因为每次修改某个模块的源码，都需要重新安装，非常容易出现版本不一致的情况。更好的方法是使用模块化编译，在编译的时候，告诉Maven几个模块之间存在依赖关系，需要一块编译，Maven就会自动按依赖顺序编译这些模块。</p> <h2 id="maven-wrapper"><a href="#maven-wrapper" class="header-anchor">#</a> Maven Wrapper</h2> <p>简单地说，Maven Wrapper就是给一个项目提供一个独立的，指定版本的Maven给它使用。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>安装Maven Wrapper最简单的方式是在项目的根目录（即pom.xml所在的目录）下运行安装命令：</p> <div class="language- extra-class"><pre class="language-text"><code>mvn -N io.takari:maven:0.7.6:wrapper
</code></pre></div><p><a href="https://github.com/takari/maven-wrapper" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>它会自动使用最新版本的Maven。注意0.7.6是Maven Wrapper的版本。最新的Maven Wrapper版本可以去官方网站查看。</p> <p>如果要指定使用的Maven版本，使用下面的安装命令指定版本，例如3.3.3：</p> <div class="language- extra-class"><pre class="language-text"><code>mvn -N io.takari:maven:0.7.6:wrapper -Dmaven=3.3.3
</code></pre></div><p>安装后，查看项目结构：</p> <div class="language- extra-class"><pre class="language-text"><code>my-project
├── .mvn
│   └── wrapper
│       ├── MavenWrapperDownloader.java
│       ├── maven-wrapper.jar
│       └── maven-wrapper.properties
├── mvnw
├── mvnw.cmd
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   └── resources
    └── test
        ├── java
        └── resources
</code></pre></div><p>发现多了mvnw、mvnw.cmd和.mvn目录，我们只需要把mvn命令改成mvnw就可以使用跟项目关联的Maven。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>mvnw clean package
</code></pre></div><p>在Linux或macOS下运行时需要加上./：</p> <div class="language- extra-class"><pre class="language-text"><code>./mvnw clean package
</code></pre></div><p>Maven Wrapper的另一个作用是把项目的mvnw、mvnw.cmd和.mvn提交到版本库中，可以使所有开发人员使用统一的Maven版本。</p> <h2 id="发布artifact到maven的repo中"><a href="#发布artifact到maven的repo中" class="header-anchor">#</a> 发布Artifact到Maven的repo中</h2> <h3 id="法1、以静态文件发布"><a href="#法1、以静态文件发布" class="header-anchor">#</a> 法1、以静态文件发布</h3> <p>如果我们观察一个中央仓库的Artifact结构，例如Commons Math，它的groupId是org.apache.commons，artifactId是commons-math3，以版本3.6.1为例，发布在中央仓库的文件夹路径就是https://repo1.maven.org/maven2/org/apache/commons/commons-math3/3.6.1/，在此文件夹下，commons-math3-3.6.1.jar就是发布的jar包，commons-math3-3.6.1.pom就是它的pom.xml描述文件，commons-math3-3.6.1-sources.jar是源代码，commons-math3-3.6.1-javadoc.jar是文档。其它以.asc、.md5、.sha1结尾的文件分别是GPG签名、MD5摘要和SHA-1摘要。</p> <p>我们只要按照这种目录结构组织文件，它就是一个有效的Maven仓库。</p> <p>我们以广受好评的开源项目how-to-become-rich为例，先创建Maven工程目录结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>how-to-become-rich
├── maven-repo        &lt;-- Maven本地文件仓库
├── pom.xml           &lt;-- 项目文件
├── src
│   ├── main
│   │   ├── java      &lt;-- 源码目录
│   │   └── resources &lt;-- 资源目录
│   └── test
│       ├── java      &lt;-- 测试源码目录
│       └── resources &lt;-- 测试资源目录
└── target            &lt;-- 编译输出目录
</code></pre></div><h3 id="通过nexus发布到中央仓库"><a href="#通过nexus发布到中央仓库" class="header-anchor">#</a> 通过Nexus发布到中央仓库</h3> <p>有的童鞋会问，能不能把自己的开源库发布到Maven的中央仓库，这样用户就不需要声明repo地址，可以直接引用，显得更专业。</p> <p>当然可以，但我们不能直接发布到Maven中央仓库，而是通过曲线救国的方式，发布到central.sonatype.org，它会定期自动同步到Maven的中央仓库。Nexus是一个支持Maven仓库的软件，由Sonatype开发，有免费版和专业版两个版本，很多大公司内部都使用Nexus作为自己的私有Maven仓库，而这个central.sonatype.org相当于面向开源的一个Nexus公共服务。</p> <p>所以，第一步是在central.sonatype.org上注册一个账号，注册链接非常隐蔽，可以自己先找找，找半小时没找到点这里查看攻略。</p> <p>如果注册顺利并审核通过，会得到一个登录账号，然后，通过这个页面一步一步操作就可以成功地将自己的Artifact发布到Nexus上，再耐心等待几个小时后，你的Artifact就会出现在Maven的中央仓库中。</p> <p>这里简单提一下发布重点与难点：</p> <p>必须正确创建GPG签名，Linux和Mac下推荐使用gnupg2；
必须在~/.m2/settings.xml中配置好登录用户名和口令，以及GPG口令：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;settings ...&gt;
    ...
    &lt;servers&gt;
        &lt;server&gt;
            &lt;id&gt;ossrh&lt;/id&gt;
            &lt;username&gt;OSSRH-USERNAME&lt;/username&gt;
            &lt;password&gt;OSSRH-PASSWORD&lt;/password&gt;
        &lt;/server&gt;
    &lt;/servers&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;ossrh&lt;/id&gt;
            &lt;activation&gt;
                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
            &lt;/activation&gt;
            &lt;properties&gt;
                &lt;gpg.executable&gt;gpg2&lt;/gpg.executable&gt;
                &lt;gpg.passphrase&gt;GPG-PASSWORD&lt;/gpg.passphrase&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
&lt;/settings&gt;
</code></pre></div><p>在待发布的Artifact的pom.xml中添加OSS的Maven repo地址，以及maven-jar-plugin、maven-source-plugin、maven-javadoc-plugin、maven-gpg-plugin、nexus-staging-maven-plugin：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;project ...&gt;
    ...
    &lt;distributionManagement&gt;
        &lt;snapshotRepository&gt;
            &lt;id&gt;ossrh&lt;/id&gt;
            &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;
        &lt;/snapshotRepository&gt;

        &lt;repository&gt;
            &lt;id&gt;ossrh&lt;/id&gt;
            &lt;name&gt;Nexus Release Repository&lt;/name&gt;
            &lt;url&gt;http://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/distributionManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                            &lt;goal&gt;test-jar&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;attach-sources&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar-no-fork&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;attach-javadocs&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;additionalOption&gt;
                                &lt;additionalOption&gt;-Xdoclint:none&lt;/additionalOption&gt;
                            &lt;/additionalOption&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;sign-artifacts&lt;/id&gt;
                        &lt;phase&gt;verify&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;sign&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.sonatype.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;nexus-staging-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.6.3&lt;/version&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;serverId&gt;ossrh&lt;/serverId&gt;
                    &lt;nexusUrl&gt;https://oss.sonatype.org/&lt;/nexusUrl&gt;
                    &lt;autoReleaseAfterClose&gt;true&lt;/autoReleaseAfterClose&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;

</code></pre></div><p>最后执行命令mvn clean package deploy即可发布至central.sonatype.org。</p> <p>此方法前期需要复杂的申请账号和项目的流程，后期需要安装调试GPG，但只要跑通流程，后续发布都只需要一行命令。</p> <h3 id="发布到私有仓库"><a href="#发布到私有仓库" class="header-anchor">#</a> 发布到私有仓库</h3> <div class="language- extra-class"><pre class="language-text"><code>
通过nexus-staging-maven-plugin除了可以发布到central.sonatype.org外，也可以发布到私有仓库，例如，公司内部自己搭建的Nexus服务器。

如果没有私有Nexus服务器，还可以发布到GitHub Packages。GitHub Packages是GitHub提供的仓库服务，支持Maven、NPM、Docker等。使用GitHub Packages时，无论是发布Artifact，还是引用已发布的Artifact，都需要明确的授权Token，因此，GitHub Packages只能作为私有仓库使用。

在发布前，我们必须首先登录后在用户的Settings-Developer settings-Personal access tokens中创建两个Token，一个用于发布，一个用于使用。发布Artifact的Token必须有repo、write:packages和read:packages权限：

token-scopes

使用Artifact的Token只需要read:packages权限。

在发布端，把GitHub的用户名和发布Token写入~/.m2/settings.xml配置中：

&lt;settings ...&gt;
    ...
    &lt;servers&gt;
        &lt;server&gt;
            &lt;id&gt;github-release&lt;/id&gt;
            &lt;username&gt;GITHUB-USERNAME&lt;/username&gt;
            &lt;password&gt;f052...c21f&lt;/password&gt;
        &lt;/server&gt;
    &lt;/servers&gt;
&lt;/settings&gt;
然后，在需要发布的Artifact的pom.xml中，添加一个&lt;repository&gt;声明：

&lt;project ...&gt;
    ...
    &lt;distributionManagement&gt;
        &lt;repository&gt;
            &lt;id&gt;github-release&lt;/id&gt;
            &lt;name&gt;GitHub Release&lt;/name&gt;
            &lt;url&gt;https://maven.pkg.github.com/michaelliao/complex&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/distributionManagement&gt;
&lt;/project&gt;
注意到&lt;id&gt;和~/.m2/settings.xml配置中的&lt;id&gt;要保持一致，因为发布时Maven根据id找到用于登录的用户名和Token，才能成功上传文件到GitHub。我们直接通过命令mvn clean package deploy部署，成功后，在GitHub用户页面可以看到该Artifact：

github-packages

完整的配置请参考complex项目，这是一个非常简单的支持复数运算的库。

使用该Artifact时，因为GitHub的Package只能作为私有仓库使用，所以除了在使用方的pom.xml中声明&lt;repository&gt;外：

&lt;project ...&gt;
    ...
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;github-release&lt;/id&gt;
            &lt;name&gt;GitHub Release&lt;/name&gt;
            &lt;url&gt;https://maven.pkg.github.com/michaelliao/complex&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.itranswarp&lt;/groupId&gt;
            &lt;artifactId&gt;complex&lt;/artifactId&gt;
            &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    ...
&lt;/project&gt;
还需要把有读权限的Token配置到~/.m2/settings.xml文件中。
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/onedocs/maven/" class="router-link-active">
        首页
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/onedocs/assets/js/app.506d831c.js" defer></script><script src="/onedocs/assets/js/2.2038ef08.js" defer></script><script src="/onedocs/assets/js/41.aa15c834.js" defer></script>
  </body>
</html>
